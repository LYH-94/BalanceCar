# 平衡車 ( 步進馬達版本 )
<p align="center">
  <img src="./docs/images/作品圖.jpg" />
</p>

[關於](#關於)

[系統設計](#系統設計)

[硬體電路](#硬體電路)

[成果展示](#成果展示)

---

# 關於

平衡車 ( 或稱兩輪自平衡機器人 )，是一種不穩定的系統，也就是說如果不對平衡車進行控制的話，車子始終會往某個方向倒下，為了保持平衡，需要利用姿態感測器感測目前車體的狀態 ( 車體的傾斜角度與角速度 )，經過控制器來控制馬達的旋轉方向與速度，藉此改變車體的狀態來維持平衡。

GitHub：[BalanceCar_StepMotor](https://github.com/LYH-94/BalanceCar/tree/main/BalanceCar_StepMotor)

# 系統設計

平衡車主要由三個部分組成：控制器、馬達和感測器。手邊剛好有一塊 STM32F446 Nucleo-64 boards 就拿來當作平衡車的控制器，雖然整個板放上去有點大有點醜但不太影響功能 ( 未來想自己做一個板出來，應該可以小很多 )，控制算法先使用常見的並行 PID 控制器，先能夠成功平衡再嘗試把控制算法換成別的。馬達使用兩相四線的 42步進馬達搭配 A4988 步進細分驅動器，雖然用直流減速馬達來做的人好像比較多，但我以前做的旋轉型倒單擺就是用直流減速馬達，這次就換步進馬達來做。感測器我使用常見的 MPU6050 姿態感測器透過卡爾曼濾波器計算可靠的角度值。

平衡車組成部分：
<p align="center">
  <img src="./docs/images/組件.png" />
</p>

控制系統圖：
<p align="center">
  <img src="./docs/images/控制系統方塊圖.png" />
</p>

我用的步進馬達是沒有回授的，屬於開迴路控制，所以沒辦法像有編碼器的馬達一樣回授馬達轉速，但因為步進馬達的指令追隨性非常高 ( 響應快 ) 且它的旋轉速度取決於輸入脈波的頻率，所以只要確保不會發生失步的話，意味著我給多快的頻率它就轉多快，所以把頻率換算成轉速直接回授也是可以的。

# 硬體電路

- 硬體
    - STM32F446 Nucleo-64 boards *1
    - MPU6050 *1
    - 兩相四線 42步進馬達 *2
    - A4988 步進細分驅動器 *2
    - 100uF 電解電容 *2 ( C1 = C2 = 100uF )
    - 兩段滑動開關 *2
    - Lipo 2S 電池 *1
    - 65mm 車輪 *2
    - 車架、銅柱跟一些連結線

<p align="center">
  <img src="./docs/images/硬體接線圖.jpg" />
</p>

# 成果展示

[![平衡車_步進馬達版本](https://res.cloudinary.com/marcomontalbano/image/upload/v1697454648/video_to_markdown/images/youtube--MU1AuTR0nbI-c05b58ac6eb4c4700831b2b3070cd403.jpg)](https://youtu.be/MU1AuTR0nbI "平衡車_步進馬達版本")

要幾乎靜止的原地平衡似乎不容易，要花很多時間調整 PID 參數，所以我只要它能夠達成基本的平衡能力就好，PID 參數調整的部分就沒有太琢磨，所以看起來有點軟，但至少確定不會倒，未來再換別的控制算法來試試看效果。
